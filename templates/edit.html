<!DOCTYPE html>
<html>
<head>
    <title>Edit Task</title>
</head>
<body>
    <h1>Edit Task</h1>
    <form action="{{ url_for('update_task', task_id=task.id) }}" method="post">
        <input type="text" name="title" value="{{ task.title }}" required>
        <input type="text" name="assigned_to" value="{{ task.assigned_to }}" required>
        <input type="date" name="due_date" value="{{ task.due_date }}" data-warning-id="due-warning-{{ task.id }}">
        <span id="due-warning-{{ task.id }}" style="color:red"></span>
        <select name="status">
            <option value="To Do" {% if task.status == 'To Do' %}selected{% endif %}>To Do</option>
            <option value="In Progress" {% if task.status == 'In Progress' %}selected{% endif %}>In Progress</option>
            <option value="Done" {% if task.status == 'Done' %}selected{% endif %}>Done</option>
        </select>
        <button type="submit">Update</button>
    </form>
    <form action="{{ url_for('delete_task', task_id=task.id) }}" method="post" style="display:inline;">
        <button type="submit" onclick="return confirm('Are you sure you want to delete this task?');">Delete</button>
    </form>
    <a href="{{ url_for('index') }}">Back</a>

    <script>
function validateDate(input, warningId) {
    const inputDate = new Date(input.value);
    const now = new Date();
    now.setHours(0,0,0,0);
    const maxDate = new Date();
    maxDate.setFullYear(now.getFullYear() + 1);

    let warning = '';
    if (input.value && inputDate < now) {
        warning = 'Due date must be in the future!';
    } else if (input.value && inputDate > maxDate) {
        warning = 'Warning: Due date is more than 12 months ahead!';
    }
    document.getElementById(warningId).textContent = warning;
    return warning === '';
}

document.addEventListener('DOMContentLoaded', function() {
    const dueDateInputs = document.querySelectorAll('input[name="due_date"]');
    dueDateInputs.forEach(function(input) {
        const warningId = input.getAttribute('data-warning-id');
        input.addEventListener('change', function() {
            validateDate(input, warningId);
        });
        input.form && input.form.addEventListener('submit', function(e) {
            if (!validateDate(input, warningId)) {
                e.preventDefault();
            }
        });
    });
});
</script>
</body>
</html>